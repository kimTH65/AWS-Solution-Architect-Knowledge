<h1>VPC（Virtual Private Cloud）- 仮想プライベートクラウド</h1>

<h2>VPCサイジング</h2>
2^16(65536個)IPアドレスを使用可能、10.0.0/16のようなCIDR(Classless Inter - Domain Routing)ブロック形態IPアドレスが必要
<br><br>許可されているCIDRブロックサイズ:
<br> /28 netmask (minimum with 2 4 - 16 available IP address)
<br> /16 netmask (maximum 2/6 16 available IP addddss 4 - 16 available IP address)

<br>個人が非公開でルーティングできるIPアドレス:
<br>10.0.0.0 ～ 10.255.255.255 (10/8 prefix)
<br>172.16.0.0 ～ 172.31.255.255 (172.16/12 prefix)
<br>192.168.0.0 ～ 192.168.255.255 (192.168/16 prefix)

<br>Ipv4は修正不可 But補助CIDR接続可能

<br>インターネットへの直接アクセスは、公開的にルーティングできるCIDRでは不可

<br>AWSアカウント内/他アカウントのvpcとピアリング接続可能

<br>10.1.0.0/16と10.0.0/16の場合はOK、But 10.0.0/16と10.3 7.0/16はipアドレスが重なって接続切れ

<br>CIDRは範囲が同じか低いものと接続可能、10.0.0/24は10.0.0/25より範囲が小さいもののみ可能

<hr>

<h2>VPCピアリング接続</h2>
<br>IPV4/6を使用して接続、同じネットワークのように通信、他のアカウント/リージョンVPC接続が可能、
<br>マンツーマン関係、単一失敗地点なし、接続数制限あり、
<br>既存のインフラを利用して接続するため、ゲートウェイ/VPN接続でもなく物理的ハードウェアに依存しない、
<br>トラフィックをAWSバックボーンに保持、パブリックインターネットX、別途料金X、転送料金O、CIDRブロック重ねると接続X、

<br>問題が生じたら？ パス、ルール、許可、ブロックの確認

<hr>

<h2>IPアドレス</h2>
<br>個人IPアドレス:
<br>インターネット接続できない、内部インスタンスから接続、
<br>インスタンスの中止/再起動時/終了する場合でも、ネットワークインタフェースに接続される。

<br>共用IPアドレス:
<br>インターネット経由で接続可能、AWSIPアドレスプールで割り当てられてAWSアカウントと接続できない、
<br>インスタンスの中止/再起動時/終了すると解除

<br>弾力的IPアドレス:
<br>必要に応じてインスタンスと接続/解除可能な静的、永久的共用IP
<br>解除されない限り個人が所有
<br>使わなくても料金請求

<hr>

<h2>Elastic Network Interface(ENI)</h2>
<br>各インスタンスは基本弾力的ネットワークインタフェース(基本ネットワークインタフェースeth0)に接続され分離できない

<hr>

<h2>Route Tables</h2>
<br>ルーティングされる位置径で決定するルール定義、各VPCにはネットワークトラフィックをルーティングする暗黙のルータがある
<br>VPC内の各サブネットは、一度に1つのルーティングテーブルと接続する必要があり、Butルーティングテーブルに複数のサブネット接続できる
<br>サブネットパスが明示的に接続されていない場合は、デフォルトのパステーブルと暗黙的に接続

<hr>

<h2> Internet Gateway (IGW)</h2>

<br>水平拡張/重複可能、VPCインスタンスとインターネット間の通信を許可

<br>共用IPがなければNAT(ネットワークアドレス変換)遂行
<br> &emsp; &emsp; &emsp; NAT使用すればプライベートサブネットがインターネットアクセス可能、But インターネットからのアクセスは不可、
<br> &emsp; &emsp; &emsp; &emsp; IPv6トラフィック対応x -> 送信専用ゲートウェイ(Egress-only Internet Gateway)使用
<h6> &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; 送信専用ゲートウェイ:

<br> &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; IPv6トラフィックに使用可能、インターネットでのアウトバウンド許可、ButインターネットからのインバウンドX
<br> &emsp; &emsp; &emsp; &emsp;　&emsp; &emsp; &emsp;  IPv4によるアウトバウンド専用インターネット通信時、NATゲートウェイを使用する必要がある </h6>

<br>トラフィック管理、権限付与およびアクセス制御、モニタリングなどを提供

<br>インスタンスへのインターネットアクセスの使用方法:
<br> &emsp; &emsp; &emsp; サブネットはインターネットゲートウェイの経路があるRouteTablesを持っている必要があります
<br> &emsp; &emsp; &emsp; インスタンスに共用IP、弾力的IPが割り当てられている必要があります
<br> &emsp; &emsp; &emsp; インスタンスに接続されたセキュリティグループおよびNACLが関連トラフィックを許可する必要があります

<hr>

<h2> VPC Security </h2>

<br>Security groups:ec2インスタンスに対するファイアウォールの役割、インバウンドおよびアウトバウンドトラフィックの両方を制御
<br> &emsp; &emsp; &emsp; Stateful性質(リクエスト情報を保存して応答するトラフィック制御を行わない)

<br> Network access controllists (ACLs):サブネットに対するファイアウォールの役割、
<br> &emsp; &emsp; &emsp; サブネットレベルでインバウンドおよび アウトバウンドトラフィック制御、
<br> &emsp; &emsp; &emsp; サブネットは1つのNACLsと接続可能 But NACLsは複数のサブネットと接続可能、
<br> &emsp; &emsp; &emsp; &emsp; Statelss性質(リクエスト情報を別途保存しないため、応答するトラフィックに対するフィルタリングを設定する必要がある)

<br>同じサブネット同士で通信する場合:Security Groupポリシーを介して通信
<br>他のサブネット同士で通信する場合:NACLポリシーを経た後、Security Groupを経る

<hr>

<h2> Subnet </h2>
<br>共用サブネットと非公開サブネットはIGW接続の有無によって異なる。（インターネットが接続されているかどうかによって）

<br>共用サブネットは共用IP、弾力的IP アドレスが必要である。

<br>VPN=プライベートゲートウェイ、インターネットには接続されていないが、仮想プライベートゲートウェイを介してルーティングされた場合、VPN専用サブネット

<hr>

<h2>共有VPC</h2>

<br>EC2インスタンス、RDSデータベースなどのアプリケーションリソースを共有·管理される中央VPCで生成、他のアカウントと共有可能

<hr>

<h2> VPC Endpoint </h2>

<br>AWSサービスに外部のインターネット区間にアクセスせず、直接アクセスして強力なセキュリティを提供するプライベートアクセス機能

<br>Gateway Endpoint:S3、DynamoDBサービスと接続
<br> Interface Endpoint : PrivateLink、独自のサービス、SaaSソリューションに非公開で接続でき、Direct Connectによる接続をサポート
<br>プライベートネットワークを利用した他のVPCウェブサーバへのアクセス方法:
<br> &emsp; &emsp; &emsp; EC2 インスタンス→インターフェースエンドポイント→プライベートリンク→NLB→それぞれのウェブサーバー
<h6> &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; PrivateLink:インターフェースエンドポイントとエンドポイントサービスを通じた接続</h6>
<hr>

<h2> VPC Flow Logs </h2>

<br>VPCのネットワークインタフェースに行き来はIPトラフィックに関する情報をキャプチャ、CloudWatchでログを収集、他のアカウントとピアリング中であれば使用できない。
